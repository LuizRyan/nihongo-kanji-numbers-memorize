<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Treino de Números em Japonês</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #options button {
      transition: background 0.4s ease, color 0.4s ease;
      background-color: #a78bfa;
      color: #fff;
      font-weight: 600;
      border-radius: 0.5rem;
      border: none;
      cursor: pointer;
    }
    #options button:hover {
      background: linear-gradient(to right, #c084fc, #a78bfa);
    }
    #options button:focus {
      outline: 3px solid #fbbf24;
    }
    #lang-toggle, #dark-toggle {
      cursor: pointer;
      padding: 6px 12px;
      border-radius: 8px;
      font-weight: 600;
      transition: background 0.3s ease, color 0.3s ease;
      position: fixed;
      top: 12px;
      z-index: 1000;
      user-select: none;
      border: none;
    }
    #lang-toggle {
      right: 12px;
      background-color: #a78bfa;
      color: white;
    }
    #lang-toggle:hover {
      background-color: #7c3aed;
    }
    #dark-toggle {
      left: 12px;
      background-color: #f97316;
      color: white;
    }
    #dark-toggle:hover {
      background-color: #ea580c;
    }
    /* Modo Noturno */
    body.dark {
      background-color: #121212;
      color: #cccccc;
    }
    body.dark #app {
      background-color: #1e1e1e;
      color: #cccccc;
      box-shadow: none;
    }
    body.dark .bg-gray-200 {
      background-color: #2a2a2a !important;
      color: #ddd !important;
    }
    body.dark #translation, body.dark #jp-number {
      color: #fbbf24;
    }
    body.dark #feedback {
      color: inherit;
    }
    body.dark #score {
      color: #cccccc;
    }
    body.dark label, body.dark select, body.dark input[type="range"] {
      color: #cccccc;
      background-color: #2c2c2c;
      border-color: #444444;
    }
    body.dark select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
    }
    body.dark #options button {
      background-color: rgba(249, 115, 22, 0.85) !important;
      color: #fff !important;
    }
    body.dark #options button:hover {
      background: linear-gradient(to right, rgba(249, 115, 22, 1), rgba(234, 88, 12, 1)) !important;
    }

    /* Canvas para fogos */
    #fireworks-canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 2000;
    }

    /* Posicionamento do volume no canto inferior direito */
    #volume-container {
      position: fixed;
      bottom: 12px;
      right: 12px;
      z-index: 1000;
      background-color: rgba(255, 255, 255, 0.8);
      padding: 10px 15px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    body.dark #volume-container {
      background-color: rgba(44, 44, 44, 0.9);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }
    #volume-label {
      font-weight: 600;
      white-space: nowrap;
      color: #333;
    }
    body.dark #volume-label {
      color: #cccccc;
    }
    #volume-slider {
      width: 120px;
      -webkit-appearance: none;
      appearance: none;
      height: 8px;
      background: #ddd;
      outline: none;
      border-radius: 4px;
      transition: background 0.2s ease;
    }
    body.dark #volume-slider {
      background: #555;
    }
    #volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #a78bfa;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    body.dark #volume-slider::-webkit-slider-thumb {
      background: #fbbf24;
    }
    #volume-slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #a78bfa;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    body.dark #volume-slider::-moz-range-thumb {
      background: #fbbf24;
    }

    /* Select personalizado para modo e opções */
    #mode {
      background-color: rgba(167, 139, 250, 0.15);
      color: #2c2c2c;
      border: 1px solid #a78bfa;
      font-weight: 600;
      padding: 0.5rem 0.75rem;
      border-radius: 0.375rem;
      transition: background-color 0.3s ease, color 0.3s ease;
      width: 100%;
      box-sizing: border-box;
      appearance: none;
      cursor: pointer;
    }
    body.dark #mode {
      background-color: rgba(255, 255, 255, 0.05);
      color: #e0e0e0;
      border-color: #444444;
    }
    #mode option {
      background-color: white;
      color: black;
    }
    body.dark #mode option {
      background-color: #1e1e1e;
      color: #ddd;
    }
  </style>
</head>
<body class="min-h-screen bg-gray-100 flex items-center justify-center p-4 relative">

  <button id="dark-toggle">Modo Noturno</button>
  <button id="lang-toggle">English</button>

  <div id="app" class="bg-white shadow-lg rounded-2xl p-6 w-full max-w-md">

    <div class="flex justify-between mb-2">
      <div id="hint-symbol" class="text-xl">☥</div>
      <div id="score" class="text-sm font-semibold">Pontuação: <strong>0/0</strong></div>
    </div>

    <div class="bg-gray-200 rounded-xl p-6 text-center mb-4">
      <div id="translation" class="text-lg font-semibold text-gray-700 mb-2"></div>
      <div id="jp-number" class="text-6xl font-black">?</div>
    </div>

    <div id="options" class="grid grid-cols-2 gap-2 mb-4"></div>
    <p id="feedback" class="text-center text-lg font-medium"></p>

    <div class="mt-6">
      <label id="mode-label" class="block mb-1 font-semibold" for="mode">Modo:</label>
      <select id="mode">
        <option value="kanji">Contagem com Kanji (三つ)</option>
        <option value="normal">Numeral Normal (いち, に, さん)</option>
        <option value="ambos">Misto</option>
        <option value="dias">Dias da Semana</option>
      </select>

      <div id="range-container" class="mt-4">
        <label id="range-label" class="block mb-1 font-semibold" for="range-slider">Intervalo:</label>
        <input type="range" id="range-slider" min="10" max="100" step="10" value="10" class="w-full p-2 border rounded-md" />
        <div id="range-value" class="text-center mt-2 font-medium">1 - 10</div>
      </div>
    </div>
  </div>

  <div id="volume-container">
    <label id="volume-label" for="volume-slider">Volume:</label>
    <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.5" />
  </div>

  <audio id="sound-correct" src="assets/correto-2.mp3" preload="auto"></audio>
  <audio id="sound-wrong" src="assets/erro.mp3" preload="auto"></audio>

  <canvas id="fireworks-canvas"></canvas>

  <script>
    // Textos
    const texts = {
      pt: {
        title: "Treino de Números em Japonês",
        score: "Pontuação",
        correct: "✅ Correto!",
        wrong: "❌ Errado! Correto:",
        modeLabel: "Modo:",
        modeOptions: [
          "Contagem com Kanji (三つ)",
          "Numeral Normal (いち, に, さん)",
          "Misto",
          "Dias da Semana"
        ],
        rangeLabel: "Intervalo:",
        langToggle: "English",
        darkToggle: "Modo Noturno",
        darkToggleActive: "Modo Claro",
        volumeLabel: "Volume:"
      },
      en: {
        title: "Japanese Numbers Training",
        score: "Score",
        correct: "✅ Correct!",
        wrong: "❌ Wrong! Correct:",
        modeLabel: "Mode:",
        modeOptions: [
          "Counting with Kanji (三つ)",
          "Normal Numeral (ichi, ni, san)",
          "Mixed",
          "Weekdays"
        ],
        rangeLabel: "Range:",
        langToggle: "Português",
        darkToggle: "Dark Mode",
        darkToggleActive: "Light Mode",
        volumeLabel: "Volume:"
      }
    };

    // Dados dos números base
    const baseNumbers = [
      ["一", "いち"], ["二", "に"], ["三", "さん"], ["四", "よん"], ["五", "ご"],
      ["六", "ろく"], ["七", "なな"], ["八", "はち"], ["九", "きゅう"], ["十", "じゅう"]
    ];

    // Construção de números de 1 a 100
    const extendedNumbers = [];
    for (let i = 1; i <= 100; i++) {
      let jp = "";
      let hira = "";
      if (i === 100) {
        jp = "百";
        hira = "ひゃく";
      } else if (i <= 10) {
        jp = baseNumbers[i - 1][0];
        hira = baseNumbers[i - 1][1];
      } else if (i < 20) {
        jp = "十" + (i % 10 !== 0 ? baseNumbers[(i % 10) - 1][0] : "");
        hira = "じゅう" + (i % 10 !== 0 ? baseNumbers[(i % 10) - 1][1] : "");
      } else if (i % 10 === 0) {
        jp = baseNumbers[Math.floor(i / 10) - 1][0] + "十";
        hira = baseNumbers[Math.floor(i / 10) - 1][1] + "じゅう";
      } else {
        jp = baseNumbers[Math.floor(i / 10) - 1][0] + "十" + baseNumbers[(i % 10) - 1][0];
        hira = baseNumbers[Math.floor(i / 10) - 1][1] + "じゅう" + baseNumbers[(i % 10) - 1][1];
      }
      extendedNumbers.push({ jp, hira, num: i });
    }

    // Dados do modo Kanji com contador
    const dataKanji = [
      { jp: "一つ", hira: "ひとつ", num: 1 },
      { jp: "二つ", hira: "ふたつ", num: 2 },
      { jp: "三つ", hira: "みっつ", num: 3 },
      { jp: "四つ", hira: "よっつ", num: 4 },
      { jp: "五つ", hira: "いつつ", num: 5 },
      { jp: "六つ", hira: "むっつ", num: 6 },
      { jp: "七つ", hira: "ななつ", num: 7 },
      { jp: "八つ", hira: "やっつ", num: 8 },
      { jp: "九つ", hira: "ここのつ", num: 9 },
      { jp: "十", hira: "とお", num: 10 }
    ];

    // Dados dos dias da semana
    const daysOfWeek = [
      { jp: "日曜日", hira: "にちようび", num: "Domingo" },
      { jp: "月曜日", hira: "げつようび", num: "Segunda" },
      { jp: "火曜日", hira: "かようび", num: "Terça" },
      { jp: "水曜日", hira: "すいようび", num: "Quarta" },
      { jp: "木曜日", hira: "もくようび", num: "Quinta" },
      { jp: "金曜日", hira: "きんようび", num: "Sexta" },
      { jp: "土曜日", hira: "どようび", num: "Sábado" }
    ];

    // Elementos do DOM
    const jpNumberEl = document.getElementById("jp-number");
    const translationEl = document.getElementById("translation");
    const hintSymbolEl = document.getElementById("hint-symbol");
    const feedbackEl = document.getElementById("feedback");
    const scoreEl = document.getElementById("score");
    const optionsEl = document.getElementById("options");
    const rangeContainer = document.getElementById("range-container");
    const modeSelect = document.getElementById("mode");
    const rangeSlider = document.getElementById("range-slider");
    const rangeValueDisplay = document.getElementById("range-value");
    const modeLabel = document.getElementById("mode-label");
    const rangeLabel = document.getElementById("range-label");
    const langToggleBtn = document.getElementById("lang-toggle");
    const darkToggleBtn = document.getElementById("dark-toggle");
    const soundCorrect = document.getElementById("sound-correct");
    const soundWrong = document.getElementById("sound-wrong");
    const volumeSlider = document.getElementById("volume-slider");
    const volumeLabel = document.getElementById("volume-label");

    // Estado
    let currentLang = "pt";
    let darkMode = false;
    let current = null;
    let hits = 0;
    let total = 0;
    let used = [];
    let locked = false;

    // Inicializa som com volume configurado
    function setVolume() {
      soundCorrect.volume = volumeSlider.value;
      soundWrong.volume = volumeSlider.value;
    }

    volumeSlider.addEventListener("input", () => {
      setVolume();
    });

    // Embaralha array
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Obtem o pool de acordo com modo e intervalo
    function getPool() {
      const mode = modeSelect.value;
      let pool = [];

      if (mode === "kanji") {
        pool = dataKanji;
        rangeContainer.style.display = "none";
      } else if (mode === "normal") {
        const range = parseInt(rangeSlider.value);
        pool = extendedNumbers.slice(0, range);
        rangeContainer.style.display = "block";
      } else if (mode === "dias") {
        pool = daysOfWeek;
        rangeContainer.style.display = "none";
      } else {
        // modo misto
        pool = [...dataKanji, ...extendedNumbers];
        rangeContainer.style.display = "none";
      }

      return pool;
    }

    // Atualiza texto do intervalo
    function updateRangeDisplay() {
      const range = parseInt(rangeSlider.value);
      rangeValueDisplay.textContent = `1 - ${range}`;
    }

    // Mostra a questão e opções
    function newChallenge() {
      if (locked) return;
      locked = true;
      feedbackEl.textContent = "";
      let pool = getPool();
      if (pool.length === 0) {
        jpNumberEl.textContent = "?";
        translationEl.textContent = "";
        optionsEl.innerHTML = "";
        return;
      }

      // Reseta se usou tudo
      if (used.length === pool.length) {
        used = [];
      }

      // Pega um item que ainda não foi usado
      let item;
      do {
        item = pool[Math.floor(Math.random() * pool.length)];
      } while (used.includes(item.jp) && used.length < pool.length);

      used.push(item.jp);
      current = item;

      // Mostra kanji/hiragana
      jpNumberEl.textContent = item.jp;

      // Tradução (ou número/dia em pt/en)
      if (currentLang === "pt") {
        translationEl.textContent = item.num;
      } else {
        translationEl.textContent = item.num.toString();
      }

      // Mostra símbolo do modo
      if (modeSelect.value === "kanji") {
        hintSymbolEl.textContent = "⸸";
      } else if (modeSelect.value === "dias") {
        hintSymbolEl.textContent = "📅";
      } else if (modeSelect.value === "normal") {
        hintSymbolEl.textContent = "☥";
      } else {
        hintSymbolEl.textContent = "♞";
      }

      // Monta opções (4 alternativas)
      let optionsPool = [];
      if (modeSelect.value === "dias") {
        optionsPool = daysOfWeek;
      } else if (modeSelect.value === "kanji") {
        optionsPool = dataKanji;
      } else if (modeSelect.value === "normal") {
        const range = parseInt(rangeSlider.value);
        optionsPool = extendedNumbers.slice(0, range);
      } else {
        optionsPool = [...dataKanji, ...extendedNumbers];
      }

      optionsPool = shuffle(optionsPool);

      let alternatives = [item];
      for (let i = 0; i < optionsPool.length && alternatives.length < 4; i++) {
        if (optionsPool[i].hira !== item.hira) {
          alternatives.push(optionsPool[i]);
        }
      }

      alternatives = shuffle(alternatives);

      optionsEl.innerHTML = "";
      alternatives.forEach(opt => {
        const btn = document.createElement("button");
        btn.textContent = opt.hira;
        btn.onclick = () => {
          if (!locked) return;
          locked = false;
          if (opt.hira === current.hira) {
            hits++;
            total++;
            feedbackEl.textContent = texts[currentLang].correct;
            soundCorrect.play();
            fireworks.start();
          } else {
            total++;
            feedbackEl.textContent = texts[currentLang].wrong + " " + current.hira;
            soundWrong.play();
          }
          updateScore();
          setTimeout(newChallenge, 1500);
        };
        optionsEl.appendChild(btn);
      });
    }

    // Atualiza placar
    function updateScore() {
      scoreEl.innerHTML = `${texts[currentLang].score}: <strong>${hits}/${total}</strong>`;
    }

    // Alternar idioma
    langToggleBtn.onclick = () => {
      currentLang = currentLang === "pt" ? "en" : "pt";

      // Atualiza textos fixos
      modeLabel.textContent = texts[currentLang].modeLabel;
      rangeLabel.textContent = texts[currentLang].rangeLabel;
      langToggleBtn.textContent = texts[currentLang].langToggle;
      darkToggleBtn.textContent = darkMode ? texts[currentLang].darkToggleActive : texts[currentLang].darkToggle;
      volumeLabel.textContent = texts[currentLang].volumeLabel;

      // Atualiza opções do select modo
      modeSelect.options[0].text = texts[currentLang].modeOptions[0];
      modeSelect.options[1].text = texts[currentLang].modeOptions[1];
      modeSelect.options[2].text = texts[currentLang].modeOptions[2];
      modeSelect.options[3].text = texts[currentLang].modeOptions[3];

      updateScore();
      newChallenge();
    };

    // Alternar modo escuro/claro
    darkToggleBtn.onclick = () => {
      darkMode = !darkMode;
      document.body.classList.toggle("dark", darkMode);
      darkToggleBtn.textContent = darkMode ? texts[currentLang].darkToggleActive : texts[currentLang].darkToggle;
      newChallenge();
    };

    // Ao mudar modo
    modeSelect.onchange = () => {
      used = [];
      if (modeSelect.value === "normal") {
        rangeContainer.style.display = "block";
      } else {
        rangeContainer.style.display = "none";
      }
      updateRangeDisplay();
      newChallenge();
    };

    // Ao mudar intervalo
    rangeSlider.oninput = () => {
      updateRangeDisplay();
      used = [];
      newChallenge();
    };

    // Inicialização
    updateRangeDisplay();
    setVolume();
    updateScore();
    newChallenge();

    // Ativar o idioma padrão e tema claro
    langToggleBtn.textContent = texts[currentLang].langToggle;
    darkToggleBtn.textContent = texts[currentLang].darkToggle;
  </script>

  <!-- Código simples para fogos de artifício -->
  <script>
    const canvas = document.getElementById('fireworks-canvas');
    const ctx = canvas.getContext('2d');
    let fireworks = {
      particles: [],
      running: false,
      start() {
        if (this.running) return;
        this.running = true;
        this.particles = [];
        for(let i=0; i<30; i++){
          this.particles.push({
            x: Math.random() * window.innerWidth,
            y: Math.random() * window.innerHeight / 2,
            dx: (Math.random() - 0.5) * 6,
            dy: (Math.random() - 0.5) * 6,
            life: 30 + Math.random() * 30,
            color: `hsl(${Math.random()*360},100%,60%)`
          });
        }
        this.animate();
      },
      animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for(let i=this.particles.length-1; i>=0; i--) {
          let p = this.particles[i];
          p.x += p.dx;
          p.y += p.dy;
          p.dy += 0.1; // gravidade
          p.life--;
          ctx.beginPath();
          ctx.fillStyle = p.color;
          ctx.globalAlpha = Math.max(p.life / 60, 0);
          ctx.arc(p.x, p.y, 3, 0, Math.PI*2);
          ctx.fill();
          if (p.life <= 0) {
            this.particles.splice(i, 1);
          }
        }
        ctx.globalAlpha = 1;
        if (this.particles.length > 0) {
          requestAnimationFrame(() => this.animate());
        } else {
          this.running = false;
          ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
      }
    };

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
  </script>

</body>
</html>
