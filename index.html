<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Treino de Números em Japonês</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* --- estilos originais (sem mudanças) --- */
    #options button{transition:background .4s,color .4s;background:#a78bfa;color:#fff;font-weight:600;border-radius:.5rem;border:none;cursor:pointer}
    #options button:hover{background:linear-gradient(to right,#c084fc,#a78bfa)}
    #options button:focus{outline:3px solid #fbbf24}
    #lang-toggle,#dark-toggle{cursor:pointer;padding:6px 12px;border-radius:8px;font-weight:600;transition:.3s;background:#a78bfa;color:#fff;border:none;position:fixed;top:12px;z-index:1000}
    #lang-toggle{right:12px}
    #lang-toggle:hover{background:#7c3aed}
    #dark-toggle{left:12px;background:#f97316}
    #dark-toggle:hover{background:#ea580c}
    body.dark{background:#121212;color:#ccc}
    body.dark #app{background:#1e1e1e;color:#ccc;box-shadow:none}
    body.dark .bg-gray-200{background:#2a2a2a !important;color:#ddd !important}
    body.dark #translation,body.dark #jp-number{color:#fbbf24}
    body.dark #options button{background:rgba(249,115,22,.85)!important}
    body.dark #options button:hover{background:linear-gradient(to right,rgba(249,115,22,1),rgba(234,88,12,1))!important}
    #fireworks-canvas{position:fixed;inset:0;width:100vw;height:100vh;pointer-events:none;z-index:2000}
    #volume-container{position:fixed;bottom:12px;right:12px;z-index:1000;background:rgba(255,255,255,.8);padding:10px 15px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.1);display:flex;align-items:center;gap:10px}
    body.dark #volume-container{background:rgba(44,44,44,.9);box-shadow:0 2px 10px rgba(0,0,0,.3)}
    #volume-slider{width:120px;-webkit-appearance:none;height:8px;background:#ddd;border-radius:4px;transition:background .2s}
    body.dark #volume-slider{background:#555}
    #volume-slider::-webkit-slider-thumb,#volume-slider::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:#a78bfa;cursor:pointer;box-shadow:0 2px 5px rgba(0,0,0,.2)}
    body.dark #volume-slider::-webkit-slider-thumb,body.dark #volume-slider::-moz-range-thumb{background:#fbbf24}
    #mode{background:rgba(167,139,250,.15);color:#2c2c2c;border:1px solid #a78bfa;font-weight:600;padding:.5rem .75rem;border-radius:.375rem;width:100%;cursor:pointer}
    body.dark #mode{background:rgba(255,255,255,.05);color:#e0e0e0;border-color:#444}
    #mode option{background:#fff;color:#000}
    body.dark #mode option{background:#1e1e1e;color:#ddd}
  </style>
</head>
<body class="min-h-screen bg-gray-100 flex items-center justify-center p-4 relative">

  <button id="dark-toggle">Modo Noturno</button>
  <button id="lang-toggle">English</button>

  <div id="app" class="bg-white shadow-lg rounded-2xl p-6 w-full max-w-md">
    <div class="flex justify-between mb-2">
      <div id="hint-symbol" class="text-xl">☥</div>
      <div id="score" class="text-sm font-semibold">Pontuação: <strong>0/0</strong></div>
    </div>

    <div class="bg-gray-200 rounded-xl p-6 text-center mb-4">
      <div id="translation" class="text-lg font-semibold text-gray-700 mb-2"></div>
      <div id="jp-number" class="text-6xl font-black">?</div>
    </div>

    <div id="options" class="grid grid-cols-2 gap-2 mb-4"></div>
    <p id="feedback" class="text-center text-lg font-medium"></p>

    <div class="mt-6">
      <label id="mode-label" class="block mb-1 font-semibold" for="mode">Modo:</label>
      <select id="mode">
        <option value="kanji">Contagem com Kanji (三つ)</option>
        <option value="normal">Numeral Normal (いち, に, さん)</option>
        <option value="ambos">Misto</option>
        <option value="dias">Dias da Semana</option>
        <option value="dias-do-mes">Dias do Mês</option>
      </select>

      <div id="range-container" class="mt-4">
        <label id="range-label" class="block mb-1 font-semibold" for="range-slider">Intervalo:</label>
        <input type="range" id="range-slider" min="10" max="1000" step="10" value="10" class="w-full p-2 border rounded-md" />
        <div id="range-value" class="text-center mt-2 font-medium">1 - 10</div>
      </div>
    </div>
  </div>

  <div id="volume-container">
    <label id="volume-label" for="volume-slider">Volume:</label>
    <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.5" />
  </div>

  <audio id="sound-correct" src="assets/correto-2.mp3" preload="auto"></audio>
  <audio id="sound-wrong" src="assets/erro.mp3" preload="auto"></audio>

  <canvas id="fireworks-canvas"></canvas>

  <script>
    /* ------------------ TEXTOS ------------------ */
    const texts = {
      pt: {
        title: "Treino de Números em Japonês",
        score: "Pontuação",
        correct: "✅ Correto!",
        wrong: "❌ Errado! Correto:",
        modeLabel: "Modo:",
        modeOptions: [
          "Contagem com Kanji (三つ)",
          "Numeral Normal (いち, に, さん)",
          "Misto",
          "Dias da Semana",
          "Dias do Mês"
        ],
        rangeLabel: "Intervalo:",
        langToggle: "English",
        darkToggle: "Modo Noturno",
        darkToggleActive: "Modo Claro",
        volumeLabel: "Volume:"
      },
      en: {
        title: "Japanese Numbers Training",
        score: "Score",
        correct: "✅ Correct!",
        wrong: "❌ Wrong! Correct:",
        modeLabel: "Mode:",
        modeOptions: [
          "Counting with Kanji (三つ)",
          "Normal Numeral (ichi, ni, san)",
          "Mixed",
          "Weekdays",
          "Days of the Month"
        ],
        rangeLabel: "Range:",
        langToggle: "Português",
        darkToggle: "Dark Mode",
        darkToggleActive: "Light Mode",
        volumeLabel: "Volume:"
      }
    };

    /* ---------- NÚMEROS 1‑10 ---------- */
    const baseNumbers = [
      ["一", "いち"], ["二", "に"], ["三", "さん"], ["四", "よん"], ["五", "ご"],
      ["六", "ろく"], ["七", "なな"], ["八", "はち"], ["九", "きゅう"], ["十", "じゅう"]
    ];

    /* ---------- NÚMEROS 1‑1000 (modo normal) ---------- */
    function buildNumbersUpTo1000() {
      const nums = [];
      for (let i = 1; i <= 1000; i++) {
        let jp = "", hira = "";

        if (i === 1000) {
          jp = "千"; hira = "せん";
        } else if (i >= 100) {
          const c = Math.floor(i / 100), r = i % 100;
          jp += (c === 1 ? "" : baseNumbers[c - 1][0]) + "百";
          hira += (c === 1 ? "" : baseNumbers[c - 1][1]) + "ひゃく";
          if (r) addBelow100(r);
        } else addBelow100(i);

        function addBelow100(n) {
          if (n > 10 && n < 20) {
            jp += "十" + (n % 10 ? baseNumbers[n % 10 - 1][0] : "");
            hira += "じゅう" + (n % 10 ? baseNumbers[n % 10 - 1][1] : "");
          } else if (n >= 20) {
            const d = Math.floor(n / 10), u = n % 10;
            jp += baseNumbers[d - 1][0] + "十" + (u ? baseNumbers[u - 1][0] : "");
            hira += baseNumbers[d - 1][1] + "じゅう" + (u ? baseNumbers[u - 1][1] : "");
          } else if (n === 10) {
            jp += "十"; hira += "じゅう";
          } else {
            jp += baseNumbers[n - 1][0]; hira += baseNumbers[n - 1][1];
          }
        }
        nums.push({ jp, hira, num: i });
      }
      return nums;
    }
    const extendedNumbers = buildNumbersUpTo1000();

    /* ---------- CONTADOR KANJI (一つ…) ---------- */
    const dataKanji = [
      { jp: "一つ", hira: "ひとつ", num: 1 },
      { jp: "二つ", hira: "ふたつ", num: 2 },
      { jp: "三つ", hira: "みっつ", num: 3 },
      { jp: "四つ", hira: "よっつ", num: 4 },
      { jp: "五つ", hira: "いつつ", num: 5 },
      { jp: "六つ", hira: "むっつ", num: 6 },
      { jp: "七つ", hira: "ななつ", num: 7 },
      { jp: "八つ", hira: "やっつ", num: 8 },
      { jp: "九つ", hira: "ここのつ", num: 9 },
      { jp: "十", hira: "とお", num: 10 }
    ];

    /* ---------- DIAS DA SEMANA ---------- */
    const daysOfWeek = [
      { jp: "日曜日", hira: "にちようび", num: "Domingo" },
      { jp: "月曜日", hira: "げつようび", num: "Segunda" },
      { jp: "火曜日", hira: "かようび", num: "Terça" },
      { jp: "水曜日", hira: "すいようび", num: "Quarta" },
      { jp: "木曜日", hira: "もくようび", num: "Quinta" },
      { jp: "金曜日", hira: "きんようび", num: "Sexta" },
      { jp: "土曜日", hira: "どようび", num: "Sábado" }
    ];

    /* ---------- DIAS DO MÊS 1‑31 ---------- */
    const daysOfMonth = [];
    for (let d = 1; d <= 31; d++) {
      // kanji do número + 日
      const jpKanji = extendedNumbers.find(e => e.num === d)?.jp || d.toString();
      const jpDay = jpKanji + "日";

      // leitura (hiragana)
      const special = {
        1:"ついたち",2:"ふつか",3:"みっか",4:"よっか",5:"いつか",6:"むいか",7:"なのか",8:"ようか",
        9:"ここのか",10:"とおか",14:"じゅうよっか",20:"はつか",24:"にじゅうよっか"
      };
      const hiraDay = special[d] || (extendedNumbers.find(e=>e.num===d)?.hira + "にち");

      // tradução PT / EN
      const ptLabel = `dia ${d}º`;
      const enLabel = `${d}${ordinalSuffixEN(d)} day`;

      daysOfMonth.push({
        jp: jpDay,
        hira: hiraDay,
        num: { pt: ptLabel, en: enLabel }
      });
    }
    function ordinalSuffixEN(n){
      const v = n % 100;
      if (v >= 11 && v <= 13) return "th";
      switch (v % 10) {
        case 1: return "st";
        case 2: return "nd";
        case 3: return "rd";
        default: return "th";
      }
    }

    /* ---------- DOM ---------- */
    const translationEl = document.getElementById("translation");
    const jpNumberEl     = document.getElementById("jp-number");
    const optionsEl      = document.getElementById("options");
    const feedbackEl     = document.getElementById("feedback");
    const scoreEl        = document.getElementById("score");
    const modeSelect     = document.getElementById("mode");
    const rangeContainer = document.getElementById("range-container");
    const rangeSlider    = document.getElementById("range-slider");
    const rangeValue     = document.getElementById("range-value");
    const langToggle     = document.getElementById("lang-toggle");
    const darkToggle     = document.getElementById("dark-toggle");
    const volumeSlider   = document.getElementById("volume-slider");
    const soundCorrect   = document.getElementById("sound-correct");
    const soundWrong     = document.getElementById("sound-wrong");

    /* ---------- ESTADO ---------- */
    let currentLang = "pt";
    let currentMode = "kanji";
    let currentNumber = null;
    let score = 0, totalQuestions = 0;
    let volume = 0.5, maxRange = 10;

    /* ---------- UI --------- */
    function translateUI() {
      document.title = texts[currentLang].title;
      scoreEl.innerHTML = `${texts[currentLang].score}: <strong>${score}/${totalQuestions}</strong>`;
      texts[currentLang].modeOptions.forEach((txt,i)=>modeSelect.options[i].text=txt);
      document.querySelector("label[for='mode']").textContent   = texts[currentLang].modeLabel;
      document.querySelector("label[for='range-slider']").textContent = texts[currentLang].rangeLabel;
      langToggle.textContent = texts[currentLang].langToggle;
      darkToggle.textContent = document.body.classList.contains("dark")
        ? texts[currentLang].darkToggleActive : texts[currentLang].darkToggle;
      document.getElementById("volume-label").textContent = texts[currentLang].volumeLabel;
      rangeValue.textContent = `1 - ${maxRange}`;
    }

    /* ---------- SELEÇÃO E EXIBIÇÃO ---------- */
    function selectNext(){
      let pool=[];
      if      (currentMode==="kanji")        pool=dataKanji;
      else if (currentMode==="normal")       pool=extendedNumbers.filter(e=>e.num<=maxRange);
      else if (currentMode==="ambos")        pool=[...dataKanji,...extendedNumbers.filter(e=>e.num<=maxRange)];
      else if (currentMode==="dias")         pool=daysOfWeek;
      else if (currentMode==="dias-do-mes")  pool=daysOfMonth;
      return pool[Math.floor(Math.random()*pool.length)];
    }

    function getOptions(correct, pool, n=4){
      const set=new Set([correct]);
      while(set.size<n) set.add(pool[Math.floor(Math.random()*pool.length)]);
      return Array.from(set).sort(()=>Math.random()-0.5);
    }

    function displayQuestion(){
      currentNumber = selectNext();
      totalQuestions++;
      scoreEl.innerHTML=`${texts[currentLang].score}: <strong>${score}/${totalQuestions-1}</strong>`;
      feedbackEl.textContent="";

      let optsPool;
      if (currentMode==="normal"||currentMode==="kanji"||currentMode==="ambos"){
        translationEl.textContent = currentNumber.num.toString();
        jpNumberEl.textContent    = currentNumber.jp || currentNumber.hira;
        optsPool = (currentMode==="kanji"?dataKanji:extendedNumbers).filter(e=>e.hira!==currentNumber.hira).map(e=>e.hira);
      } else if (currentMode==="dias") {
        translationEl.textContent = currentNumber.num;
        jpNumberEl.textContent    = currentNumber.jp;
        optsPool = daysOfWeek.filter(e=>e.hira!==currentNumber.hira).map(e=>e.hira);
      } else { // dias-do-mes
        translationEl.textContent = currentNumber.num[currentLang];
        jpNumberEl.textContent    = currentNumber.jp;
        optsPool = daysOfMonth.filter(e=>e.hira!==currentNumber.hira).map(e=>e.hira);
      }
      const options=getOptions(currentNumber.hira,optsPool);
      renderOptions(options,currentNumber.hira);
    }

    function renderOptions(list, correct){
      optionsEl.innerHTML="";
      list.forEach(txt=>{
        const b=document.createElement("button");
        b.textContent=txt;
        b.type="button";
        b.onclick=()=>{
          if(txt===correct){
            score++; feedbackEl.textContent=texts[currentLang].correct; play("correct");
          }else{
            feedbackEl.textContent=`${texts[currentLang].wrong} ${correct}`; play("wrong");
          }
          scoreEl.innerHTML=`${texts[currentLang].score}: <strong>${score}/${totalQuestions}</strong>`;
          setTimeout(displayQuestion,800);
        };
        optionsEl.appendChild(b);
      });
    }

    function play(type){
      const snd=type==="correct"?soundCorrect:soundWrong;
      snd.volume=volume; snd.currentTime=0; snd.play();
    }

    /* ---------- EVENTOS ---------- */
    modeSelect.onchange=()=>{
      currentMode=modeSelect.value; score=totalQuestions=0; translateUI();
      rangeContainer.style.display=currentMode==="normal"?"block":"none";
      displayQuestion();
    };
    rangeSlider.oninput=()=>{maxRange=parseInt(rangeSlider.value); rangeValue.textContent=`1 - ${maxRange}`; displayQuestion();};
    langToggle.onclick=()=>{currentLang=currentLang==="pt"?"en":"pt"; translateUI(); displayQuestion();};
    darkToggle.onclick=()=>{document.body.classList.toggle("dark"); translateUI();};
    volumeSlider.oninput=()=>{volume=parseFloat(volumeSlider.value);};

    /* ---------- INÍCIO ---------- */
    translateUI();
    rangeContainer.style.display="none";
    displayQuestion();

    /* ---------- FOGOS (mesmo código de antes) ---------- */
    const canvas=document.getElementById("fireworks-canvas"), ctx=canvas.getContext("2d");
    window.onresize=()=>{canvas.width=innerWidth; canvas.height=innerHeight};
    window.onresize();
    let fireworks=[];
   class Firework {
  constructor(x, y) {
    this.p = [];
    for (let i = 0; i < 40; i++) {
      this.p.push({
        x,
        y,
        a: Math.random() * 2 * Math.PI,
        speed: Math.random() * 5 + 2,
        r: Math.random() * 2 + 1,
        alpha: 1,
        d: 0.02 + Math.random() * 0.03, // desaparecer mais rápido
        color: `hsl(${Math.random() * 360}, 100%, 70%)`
      });
    }
  }
  update() {
    this.p.forEach(o => {
      o.x += Math.cos(o.a) * o.speed;
      o.y += Math.sin(o.a) * o.speed;
      o.speed *= 0.95;
      o.alpha -= o.d;
    });
    this.p = this.p.filter(o => o.alpha > 0);
    return this.p.length > 0;
  }
  draw() {
    this.p.forEach(o => {
      ctx.beginPath();
      ctx.arc(o.x, o.y, o.r, 0, 2 * Math.PI);
      const [r, g, b] = hslToRgb(o.color);
      ctx.fillStyle = `rgba(${r},${g},${b},${o.alpha})`;
      ctx.fill();
    });
  }
}

    function hslToRgb(h){const m=h.match(/\d+/g);if(!m)return[255,255,255];const H=+m[0],C=(1-Math.abs(2*(+m[2]/100)-1))*(+m[1]/100),X=C*(1-Math.abs((H/60)%2-1)),m0=(+m[2]/100)-C/2;let r=0,g=0,b=0;
      if(H<60)[r,g]=[C,X];else if(H<120)[r,g]=[X,C];else if(H<180)[g,b]=[C,X];else if(H<240)[g,b]=[X,C];else if(H<300)[r,b]=[X,C];else[r,b]=[C,X];
      return[Math.round((r+m0)*255),Math.round((g+m0)*255),Math.round((b+m0)*255)]}
    function loop(){ctx.clearRect(0,0,canvas.width,canvas.height);fireworks=fireworks.filter(f=>f.update());fireworks.forEach(f=>f.draw());requestAnimationFrame(loop)}
    loop();
  // Substitua esta parte final do seu script:

function play(type){
  const snd = type === "correct" ? soundCorrect : soundWrong;
  snd.volume = volume;
  snd.currentTime = 0;
  snd.play();

  if (type === "correct" && document.body.classList.contains("dark")) {
    // Lança múltiplos fogos com efeito visual mais intenso
    for (let i = 0; i < 6; i++) {
      const x = window.innerWidth / 2 + (Math.random() - 0.5) * 300;
      const y = window.innerHeight / 2 + (Math.random() - 0.5) * 300;
      fireworks.push(new Firework(x, y));
    }
  }
}


  </script>
</body>
</html>
