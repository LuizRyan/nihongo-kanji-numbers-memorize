<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Treino de Números em Japonês</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #options button {
      transition: background 0.4s ease, color 0.4s ease;
    }
    #options button:hover {
      background: linear-gradient(to right, #c084fc, #a78bfa);
    }
    #lang-toggle {
      cursor: pointer;
      background-color: rgba(167, 139, 250, 0.85);
      color: white;
      padding: 6px 12px;
      border-radius: 8px;
      font-weight: 600;
      transition: background 0.3s ease;
      position: fixed;
      top: 12px;
      right: 12px;
      z-index: 1000;
      user-select: none;
    }
    #lang-toggle:hover {
      background-color: rgba(124, 58, 237, 0.9);
    }
    #dark-toggle {
      cursor: pointer;
      background-color: rgba(249, 115, 22, 0.35);
      color: white;
      padding: 6px 12px;
      border-radius: 8px;
      font-weight: 600;
      transition: background 0.3s ease;
      position: fixed;
      top: 12px;
      left: 12px;
      z-index: 1000;
      user-select: none;
    }
    #dark-toggle:hover {
      background-color: rgba(234, 88, 12, 0.7);
    }
    /* Modo Noturno */
    body.dark {
      background-color: #121212;
      color: #cccccc;
    }
    body.dark #app {
      background-color: #1e1e1e;
      color: #cccccc;
      box-shadow: none;
    }
    body.dark .bg-gray-200 {
      background-color: #2a2a2a !important;
      color: #ddd !important;
    }
    body.dark #translation, body.dark #jp-number {
      color: #fbbf24;
    }
    body.dark #feedback {
      color: inherit;
    }
    body.dark #score {
      color: #cccccc;
    }
    body.dark label, body.dark select {
      color: #cccccc;
      background-color: #2c2c2c;
      border-color: #444444;
    }
    body.dark select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
    }
    body.dark #options button {
      background-color: rgba(249, 115, 22, 0.35) !important;
      color: #fff !important;
    }
    body.dark #options button:hover {
      background: linear-gradient(to right, rgba(249, 115, 22, 0.6), rgba(234, 88, 12, 0.6)) !important;
    }

    /* Canvas para fogos */
    #fireworks-canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 2000;
    }

    /* Container volume */
    #volume-container {
      margin-top: 12px;
    }
    #volume-label {
      font-weight: 600;
      margin-bottom: 4px;
      display: block;
    }
    #volume-slider {
      width: 100%;
    }
  </style>
</head>
<body class="min-h-screen bg-gray-100 flex items-center justify-center p-4 relative">

  <button id="dark-toggle">Modo Noturno</button>
  <button id="lang-toggle">English</button>

  <div id="app" class="bg-white shadow-lg rounded-2xl p-6 w-full max-w-md">

    <div class="flex justify-between mb-2">
      <div id="hint-symbol" class="text-xl">☥</div>
      <div id="score" class="text-sm font-semibold">Pontuação: <strong>0/0</strong></div>
    </div>

    <div class="bg-gray-200 rounded-xl p-6 text-center mb-4">
      <div id="translation" class="text-lg font-semibold text-gray-700 mb-2"></div>
      <div id="jp-number" class="text-6xl font-black">?</div>
    </div>

    <div id="options" class="grid grid-cols-2 gap-2 mb-4"></div>
    <p id="feedback" class="text-center text-lg font-medium"></p>

    <div class="mt-6">
      <label id="mode-label" class="block mb-1 font-semibold" for="mode">Modo:</label>
      <select id="mode" class="w-full p-2 border rounded-md mb-4">
        <option value="kanji">Contagem com Kanji (三つ)</option>
        <option value="normal">Numeral Normal (いち, に, さん)</option>
        <option value="ambos">Misto</option>
      </select>

      <div id="range-container">
        <label id="range-label" class="block mb-1 font-semibold" for="range">Intervalo:</label>
        <select id="range" class="w-full p-2 border rounded-md">
          <option value="10">1 - 10</option>
          <option value="20">1 - 20</option>
          <option value="30">1 - 30</option>
          <option value="40">1 - 40</option>
          <option value="50">1 - 50</option>
          <option value="60">1 - 60</option>
          <option value="70">1 - 70</option>
          <option value="80">1 - 80</option>
          <option value="90">1 - 90</option>
          <option value="100">1 - 100</option>
        </select>
      </div>

      <!-- Controle de volume -->
      <div id="volume-container">
        <label id="volume-label" for="volume-slider">Volume:</label>
        <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.5" />
      </div>

    </div>
  </div>

  <!-- Áudios locais -->
  <audio id="sound-correct" src="assets/correto-2.mp3" preload="auto"></audio>
  <audio id="sound-wrong" src="assets/erro.mp3" preload="auto"></audio>

  <!-- Canvas para fogos -->
  <canvas id="fireworks-canvas"></canvas>

  <script>
    // Textos
    const texts = {
      pt: {
        title: "Treino de Números em Japonês",
        score: "Pontuação",
        correct: "✅ Correto!",
        wrong: "❌ Errado! Correto:",
        modeLabel: "Modo:",
        modeOptions: [
          "Contagem com Kanji (三つ)",
          "Numeral Normal (いち, に, さん)",
          "Misto"
        ],
        rangeLabel: "Intervalo:",
        langToggle: "English",
        darkToggle: "Modo Noturno",
        darkToggleActive: "Modo Claro",
        volumeLabel: "Volume:"
      },
      en: {
        title: "Japanese Numbers Training",
        score: "Score",
        correct: "✅ Correct!",
        wrong: "❌ Wrong! Correct:",
        modeLabel: "Mode:",
        modeOptions: [
          "Counting with Kanji (三つ)",
          "Normal Numeral (いち, に, さん)",
          "Mixed"
        ],
        rangeLabel: "Range:",
        langToggle: "Português",
        darkToggle: "Dark Mode",
        darkToggleActive: "Light Mode",
        volumeLabel: "Volume:"
      }
    };

    // Dados dos números
    const baseNumbers = [
      ["一", "いち"], ["二", "に"], ["三", "さん"], ["四", "よん"], ["五", "ご"],
      ["六", "ろく"], ["七", "なな"], ["八", "はち"], ["九", "きゅう"], ["十", "じゅう"]
    ];

    const extendedNumbers = [];
    for (let i = 1; i <= 100; i++) {
      let jp = "";
      let hira = "";
      if (i <= 10) {
        jp = baseNumbers[i - 1][0];
        hira = baseNumbers[i - 1][1];
      } else if (i < 20) {
        jp = "十" + (i % 10 !== 0 ? baseNumbers[(i % 10) - 1][0] : "");
        hira = "じゅう" + (i % 10 !== 0 ? baseNumbers[(i % 10) - 1][1] : "");
      } else if (i % 10 === 0) {
        jp = baseNumbers[Math.floor(i / 10) - 1][0] + "十";
        hira = baseNumbers[Math.floor(i / 10) - 1][1] + "じゅう";
      } else {
        jp = baseNumbers[Math.floor(i / 10) - 1][0] + "十" + baseNumbers[(i % 10) - 1][0];
        hira = baseNumbers[Math.floor(i / 10) - 1][1] + "じゅう" + baseNumbers[(i % 10) - 1][1];
      }
      extendedNumbers.push({ jp, hira, num: i });
    }

    const dataKanji = [
      { jp: "一つ", hira: "ひとつ", num: 1 },
      { jp: "二つ", hira: "ふたつ", num: 2 },
      { jp: "三つ", hira: "みっつ", num: 3 },
      { jp: "四つ", hira: "よっつ", num: 4 },
      { jp: "五つ", hira: "いつつ", num: 5 },
      { jp: "六つ", hira: "むっつ", num: 6 },
      { jp: "七つ", hira: "ななつ", num: 7 },
      { jp: "八つ", hira: "やっつ", num: 8 },
      { jp: "九つ", hira: "ここのつ", num: 9 },
      { jp: "十", hira: "とお", num: 10 }
    ];

    // Elementos DOM
    const jpNumberEl = document.getElementById("jp-number");
    const translationEl = document.getElementById("translation");
    const hintSymbolEl = document.getElementById("hint-symbol");
    const feedbackEl = document.getElementById("feedback");
    const scoreEl = document.getElementById("score");
    const optionsEl = document.getElementById("options");
    const rangeContainer = document.getElementById("range-container");
    const modeSelect = document.getElementById("mode");
    const rangeSelect = document.getElementById("range");
    const modeLabel = document.getElementById("mode-label");
    const rangeLabel = document.getElementById("range-label");
    const langToggleBtn = document.getElementById("lang-toggle");
    const darkToggleBtn = document.getElementById("dark-toggle");
    const soundCorrect = document.getElementById("sound-correct");
    const soundWrong = document.getElementById("sound-wrong");
    const volumeSlider = document.getElementById("volume-slider");
    const volumeLabel = document.getElementById("volume-label");

    // Estado
    let currentLang = "pt";
    let darkMode = false;
    let current;
    let hits = 0;
    let total = 0;
    let used = [];
    let locked = false; // trava para não clicar várias vezes

    // Define volume inicial
    soundCorrect.volume = volumeSlider.value;
    soundWrong.volume = volumeSlider.value;

    // Função para embaralhar
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Obter pool de opções de acordo com modo e intervalo
    function getPool() {
      const mode = modeSelect.value;
      const range = parseInt(rangeSelect.value);
      let pool = [];
      if (mode === "kanji") pool = dataKanji;
      else if (mode === "normal") pool = extendedNumbers.slice(0, range);
      else pool = [...dataKanji, ...extendedNumbers.slice(0, range)];

      return pool.map(item => {
        let tipo = "";
        if (mode === "ambos") {
          tipo = extendedNumbers.some(e => e.num === item.num) ? "☥" : "⸸";
        }
        return { ...item, tipo };
      });
    }

    // Começa novo desafio
    function newChallenge() {
      locked = false;
      const mode = modeSelect.value;
      rangeContainer.style.display = (mode === "kanji") ? "none" : "block";

      let pool = getPool();
      const remaining = pool.filter(item => !used.includes(item.jp));
      if (remaining.length === 0) {
        used = [];
        newChallenge();
        return;
      }
      current = remaining[Math.floor(Math.random() * remaining.length)];

      jpNumberEl.textContent = current.jp;
      translationEl.textContent = `${current.num}`;
      hintSymbolEl.textContent = current.tipo || "";
      feedbackEl.textContent = "";

      const correct = current.hira;
      const distractors = shuffle(getPool().filter(e => e.hira && e.hira !== correct)).slice(0, 3).map(e => e.hira);
      const options = shuffle([correct, ...distractors]);

      optionsEl.innerHTML = "";
      options.forEach(opt => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.className = "bg-indigo-100 hover:bg-indigo-200 text-indigo-800 font-semibold py-2 px-4 rounded-md";
        btn.onclick = () => checkAnswer(opt);
        optionsEl.appendChild(btn);
      });
    }

    // Atualiza pontuação
    function updateScore() {
      scoreEl.innerHTML = `${texts[currentLang].score}: <strong>${hits}/${total}</strong>`;
    }

    // Efeito simples de fogos
    const canvas = document.getElementById("fireworks-canvas");
    const ctx = canvas.getContext("2d");
    let fireworks = [];
    let animationFrameId;

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    class Firework {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.radius = 0;
        this.maxRadius = 50 + Math.random() * 30;
        this.color = `hsl(${Math.random() * 360}, 100%, 60%)`;
        this.alpha = 1;
      }
      draw() {
        ctx.beginPath();
        ctx.strokeStyle = `rgba(${hexToRgb(this.color)},${this.alpha})`;
        ctx.lineWidth = 2;
        ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI);
        ctx.stroke();
      }
      update() {
        this.radius += 2;
        this.alpha -= 0.03;
      }
      done() {
        return this.alpha <= 0;
      }
    }

    function hexToRgb(h) {
      return "255, 100, 50";
    }

    function animateFireworks() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      fireworks.forEach(fw => {
        fw.update();
        fw.draw();
      });
      fireworks = fireworks.filter(fw => !fw.done());
      if (fireworks.length > 0) {
        animationFrameId = requestAnimationFrame(animateFireworks);
      }
    }

    function launchFireworks() {
      for (let i = 0; i < 5; i++) {
        const x = Math.random() * window.innerWidth;
        const y = Math.random() * window.innerHeight * 0.5 + window.innerHeight * 0.5;
        fireworks.push(new Firework(x, y));
      }
      if (!animationFrameId) {
        animateFireworks();
      }
    }

    // Função para verificar resposta
    function checkAnswer(value) {
      if (locked) return;
      locked = true;

      if (!value) return;
      total++;
      const correct = current.hira;
      if (value === correct) {
        feedbackEl.textContent = texts[currentLang].correct;
        feedbackEl.className = "text-green-600";
        hits++;
        used.push(current.jp);

        soundCorrect.currentTime = 0;
        soundCorrect.play();

        launchFireworks();

      } else {
        feedbackEl.textContent = `${texts[currentLang].wrong} ${correct}`;
        feedbackEl.className = "text-red-600";

        soundWrong.currentTime = 0;
        soundWrong.play();
      }
      updateScore();
      setTimeout(newChallenge, 1500);
    }

    // Atualiza textos de acordo com idioma
    function updateLangTexts() {
      document.title = texts[currentLang].title;
      langToggleBtn.textContent = texts[currentLang].langToggle;
      darkToggleBtn.textContent = darkMode ? texts[currentLang].darkToggleActive : texts[currentLang].darkToggle;

      modeLabel.textContent = texts[currentLang].modeLabel;
      rangeLabel.textContent = texts[currentLang].rangeLabel;
      volumeLabel.textContent = texts[currentLang].volumeLabel;

      modeSelect.options[0].text = texts[currentLang].modeOptions[0];
      modeSelect.options[1].text = texts[currentLang].modeOptions[1];
      modeSelect.options[2].text = texts[currentLang].modeOptions[2];

      updateScore();
    }

    // Eventos

    langToggleBtn.addEventListener("click", () => {
      currentLang = currentLang === "pt" ? "en" : "pt";
      hits = 0; total = 0; used = [];
      updateLangTexts();
      newChallenge();
    });

    darkToggleBtn.addEventListener("click", () => {
      darkMode = !darkMode;
      if (darkMode) document.body.classList.add("dark");
      else document.body.classList.remove("dark");
      updateLangTexts();
    });

    modeSelect.addEventListener("change", () => {
      hits = 0; total = 0; used = [];
      updateScore();
      newChallenge();
    });

    rangeSelect.addEventListener("change", () => {
      hits = 0; total = 0; used = [];
      updateScore();
      newChallenge();
    });

    volumeSlider.addEventListener("input", () => {
      const vol = parseFloat(volumeSlider.value);
      soundCorrect.volume = vol;
      soundWrong.volume = vol;
    });

    // Inicialização
    updateLangTexts();
    updateScore();
    newChallenge();
  </script>
</body>
</html>
